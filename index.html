<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Resizer</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    label { margin-right: 0.5em; }
    select, input { margin-right: 1em; }
    #message { margin-top: 1em; }
    #output img { max-width: 100%; height: auto; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Image Resizer</h1>

  <div>
    <label>Choose image:</label>
    <input type="file" id="fileInput" accept="image/*" />
    <button id="uploadBtn">Upload</button>
  </div>

  <div style="margin-top:1em;">
    <label>Width (px):</label>
    <input type="number" id="widthInput" value="400" min="1" />
    <label>Height (px):</label>
    <input type="number" id="heightInput" value="200" min="1" />

    <label>Format:</label>
    <select id="format">
      <option value="jpeg">JPEG</option>
      <option value="png">PNG</option>
      <option value="webp">WebP</option>
    </select>

    <button id="resizeBtn">Resize</button>
  </div>

  <div id="message"></div>
  <div id="output"></div>

  <script>
    // ─── EDIT THIS ───
    const BASE = "https://7osvl1bpw3.execute-api.us-east-2.amazonaws.com"; 
    // ─────────────────

    let uploadedKey = null;

    const fileInput   = document.getElementById("fileInput");
    const uploadBtn   = document.getElementById("uploadBtn");
    const resizeBtn   = document.getElementById("resizeBtn");
    const widthInput  = document.getElementById("widthInput");
    const heightInput = document.getElementById("heightInput");
    const formatInput = document.getElementById("format");
    const messageDiv  = document.getElementById("message");
    const outputDiv   = document.getElementById("output");

    uploadBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("Please choose a file first.");
        return;
      }
      // generate upload URL
      messageDiv.textContent = "Fetching upload URL…";
      const key = encodeURIComponent(file.name);
      const res1 = await fetch(`${BASE}/generateUploadURL?key=${key}`);
      if (!res1.ok) {
        messageDiv.textContent = "Error getting upload URL.";
        return;
      }
      const { uploadURL } = await res1.json();

      // PUT the file
      messageDiv.textContent = "Uploading…";
      const res2 = await fetch(uploadURL, {
        method: "PUT",
        body: file
      });
      if (!res2.ok) {
        messageDiv.textContent = "Upload failed.";
        return;
      }
      messageDiv.innerHTML = "✅ Upload successful!";
      uploadedKey = file.name;
    });

    resizeBtn.addEventListener("click", async () => {
      if (!uploadedKey) {
        alert("Upload an image first.");
        return;
      }
      const width  = parseInt(widthInput.value, 10);
      const height = parseInt(heightInput.value, 10);
      const format = formatInput.value;

      messageDiv.textContent = "Resizing…";
      outputDiv.innerHTML = "";

      const res = await fetch(`${BASE}/process-image`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          key: uploadedKey,
          width, height,
          format
        })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        messageDiv.textContent = `❌ Error: ${err.error||res.statusText}`;
        return;
      }

      const { url } = await res.json();
      messageDiv.innerHTML = "✅ Resize complete!";
      const img = document.createElement("img");
      img.src = url;
      outputDiv.appendChild(img);
    });
  </script>
</body>
</html>
