<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Resizer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; }
    input, button { margin: 0.5em 0; }
    #status { margin-top: 1em; color: #c00; }
    #outputImg { display: block; margin-top: 1em; max-width: 100%; }
  </style>
</head>
<body>
  <h1>Image Resizer</h1>

  <label>
    Choose image:
    <input type="file" id="fileInput" accept="image/*" />
  </label>
  <button id="uploadBtn">Upload</button>

  <div>
    <label>
      Width (px):
      <input type="number" id="widthInput" value="400" min="1" />
    </label>
    <label>
      Height (px):
      <input type="number" id="heightInput" value="400" min="1" />
    </label>
    <button id="resizeBtn">Resize</button>
  </div>

  <div id="status">Status messages will appear here</div>
  <img id="outputImg" alt="Resized image will appear here" />

  <script>
    // ‚Äî‚Äî‚Äî API configuration ‚Äî‚Äî‚Äî
    const BASE       = 'https://7osvl1bpw3.execute-api.us-east-2.amazonaws.com';
    const apiUpload  = BASE + '/generateUploadURL';
    const apiProcess = BASE + '/process-image';

    // ‚Äî‚Äî‚Äî UI elements ‚Äî‚Äî‚Äî
    const fileIn     = document.getElementById('fileInput');
    const uploadBtn  = document.getElementById('uploadBtn');
    const resizeBtn  = document.getElementById('resizeBtn');
    const widthIn    = document.getElementById('widthInput');
    const heightIn   = document.getElementById('heightInput');
    const statusEl   = document.getElementById('status');
    const outImg     = document.getElementById('outputImg');

    let uploadedKey = null;

    // ‚Äî‚Äî‚Äî Upload handler ‚Äî‚Äî‚Äî
    uploadBtn.onclick = async () => {
      const file = fileIn.files[0];
      if (!file) {
        statusEl.textContent = '‚ö†Ô∏è Please select a file first.';
        return;
      }
      statusEl.textContent = 'üîÑ Generating upload URL‚Ä¶';
      try {
        const resp1 = await fetch(`${apiUpload}?key=${encodeURIComponent(file.name)}`);
        if (!resp1.ok) throw new Error(`Status ${resp1.status}`);
        const { uploadURL } = await resp1.json();

        statusEl.textContent = 'üîÑ Uploading image‚Ä¶';
        const resp2 = await fetch(uploadURL, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/octet-stream' },
          body: file
        });
        if (!resp2.ok) throw new Error(`Upload failed: ${resp2.status}`);

        uploadedKey = file.name;
        statusEl.textContent = '‚úÖ Upload successful! Now set dimensions and click Resize.';
      } catch (err) {
        statusEl.textContent = '‚ùå ' + err.message;
      }
    };

    // ‚Äî‚Äî‚Äî Resize handler ‚Äî‚Äî‚Äî
    resizeBtn.onclick = async () => {
      if (!uploadedKey) {
        statusEl.textContent = '‚ö†Ô∏è Upload an image first.';
        return;
      }
      const w = parseInt(widthIn.value, 10);
      const h = parseInt(heightIn.value, 10);
      if (!w || !h) {
        statusEl.textContent = '‚ö†Ô∏è Enter valid width and height.';
        return;
      }
      statusEl.textContent = 'üîÑ Requesting resize‚Ä¶';
      try {
        const resp = await fetch(apiProcess, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ key: uploadedKey, width: w, height: h })
        });
        if (!resp.ok) throw new Error(await resp.text());
        const { url } = await resp.json();
        outImg.src = url;
        statusEl.textContent = '‚úÖ Resize complete!';
      } catch (err) {
        statusEl.textContent = '‚ùå ' + err.message;
      }
    };
  </script>
</body>
</html>
